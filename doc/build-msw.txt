Copyright (c) 2009-2012 Bitcoin Developers
Distributed under the MIT/X11 software license, see the accompanying
file license.txt or http://www.opensource.org/licenses/mit-license.php.
This product includes software developed by the OpenSSL Project for use in
the OpenSSL Toolkit (http://www.openssl.org/).  This product includes
cryptographic software written by Eric Young (eay@cryptsoft.com) and UPnP
software written by Thomas Bernard.


See readme-qt.rst for instructions on building Bitcoin QT, the
graphical user interface.

WINDOWS BUILD NOTES
===================

Compilers Supported
-------------------
Note: our official releases are compiled using mingw running on Windows 10.


Dependencies
------------
Libraries you need to download separately and build:

Library         Default path
OpenSSL         C:\RIchCoin\lib\openssl-1.0.1p
Berkeley DB     C:\RIchCoin\lib\db-4.8.30.NC
Boost           C:\RIchCoin\lib\boost-1.58.0
miniupnpc       C:\RIchCoin\lib\miniupnpc-1.9.20151008
libpng          C:\RIchCoin\lib\libpng-1.6.16
libevent        C:\RIchCoin\lib\libevent-2.1.8-stable
pkg-config-lite C:\RIchCoin\lib\pkg-config-lite-0.28-1
protobuf        C:\RIchCoin\lib\protobuf-2.6.1
gtest (1.7.0)   C:\RIchCoin\lib\protobuf-2.6.1\gtest
qrencode        C:\RIchCoin\lib\qrencode-3.4.3
QTbase 5.3.2    C:\RIchCoin\Qt\5.3.2
QTtools 5.3.2   C:\RIchCoin\Qt\qttools-opensource-src-5.3.2

Compilers
----------
You also need to install MinGW to C:/MinGW and add it to your PATH.
Following that, you will also need to download i686-4.9.4-release-posix-dwarf-rt_XXX.7z unzipped with 7-Zip and put in C:\RIchCoin\.

libevent
--------
Using the MSYS shell in C:\MinGW\msys\1.0, run the following commands:
cd C:\RIchCoin\lib\libevent-2.1.8-stable
./configure --disable-shared --disable-openssl --disable-libevent-regress --disable-debug-mode
make

BerkeleyDB
-----------
Using the MSYS shell in C:\MinGW\msys\1.0, run the following commands:
cd C:\RIchCoin\lib\db-4.8.30.NC\build_unix
../dist/configure --disable-replication --enable-mingw --enable-cxx --disable-shared\
    CXXFLAGS="${ADDITIONALCCFLAGS}" \
    CFLAGS="${ADDITIONALCCFLAGS}"
make

OpenSSL
-------
Using the MSYS shell in C:\MinGW\msys\1.0, run the following commands:
cd C:\RIchCoin\lib\openssl-1.0.1p
export CC="gcc ${ADDITIONALCCFLAGS}"
./config
make

libpng
------
Using the MSYS shell in C:\MinGW\msys\1.0, run the following commands:
cd C:\RIchCoin\lib\libpng-1.6.16
./configure --disable-shared
make
cp .libs/libpng16.a .libs/libpng.a

protobuf
--------
Using the MSYS shell in C:\MinGW\msys\1.0, run the following commands:
cd C:\RIchCoin\lib\protobuf-2.6.1
./autogen.sh
./configure --disable-shared
make

Boost
------
Using the MSYS shell in C:\MinGW\msys\1.0, run the following commands:
cd C:\RIchCoin\lib\boost-1.58.0
bootstrap.bat mingw
b2.exe --build-type=minimal --with-chrono --with-filesystem --with-program_options --with-system --with-thread^
    --layout=versioned -sNO_BZIP2=1 -sNO_ZLIB=1^
    variant=release^
    toolset=gcc^
    link=static^
    threading=multi^
    target-os=windows^
    threadapi=win32^
    cxxflags="%ADDITIONALCCFLAGS%"^
    cflags="%ADDITIONALCCFLAGS%"^
    runtime-link=static^
    stage

QT5
---
Using the MSYS shell in C:\MinGW\msys\1.0, run the following commands:
cd C:\RIchCoin\Qt\5.3.2
set INCLUDE=C:\RIchCoin\lib\libpng-1.6.16;C:\RIchCoin\lib\openssl-1.0.1p/include
set INCLUDE=%INCLUDE:/=\%
set LIB=C:\RIchCoin\lib\libpng-1.6.16/.libs;C:\RIchCoin\lib\openssl-1.0.1p
configure.exe -release -opensource -confirm-license -static -make libs -no-sql-sqlite -no-opengl -system-zlib -qt-pcre -no-icu -no-gif -system-libpng -no-libjpeg -no-freetype -no-angle -openssl -no-dbus -no-audio-backend -no-wmf-backend -no-qml-debug -no-vcproj
mingw32-make

cd C:\RIchCoin\Qt\qttools-opensource-src-5.3.2
qmake qttools.pro
mingw32-make

Compiling RIchCoin
------------------
In C:\RIchCoin, run git clone https://github.com/RIchCoin-devs/RIchCoin-Core.git.
In C:\RIchCoin, make a textfile called compile.bat. Using a text editor, enter the following lines:

# miniupnpc
sed -i.bak 's/\$(CC) -enable-stdcall-fixup/\$(CC) -Wl,-enable-stdcall-fixup/g'lib/miniupnpc-1.9.20151008/miniupnpc/Makefile.mingw  # workaround, see http://stackoverflow.com/questions/13227354/warning-cannot-find-entry-symbol-nable-stdcall-fixup-defaulting
sed -i.bak 's/all:	init upnpc-static upnpc-shared testminixml libminiupnpc.a miniupnpc.dll/all:	init upnpc-static/g' lib/miniupnpc-1.9.20151008/miniupnpc/Makefile.mingw  # only need static, rest is not compiling

# qttools - disable windeployqt
sed -i.bak 's/win32|winrt:SUBDIRS += windeployqt/#win32|winrt:SUBDIRS += windeployqt/g' QT/qttools-opensource-src-5.3.2/src/src.pro  # not compiling without fixes

echo Building daemon and qt...
cd RIchCoin-Core
./autogen.sh
if [ ${?} -ne 0 ]; then echo "daemon autogen failed."; read -n 1 -s; exit 1;fi

LIBSH=$EWBPATHMSYS/$LIB

CPPFLAGS="-I$LIBSH/$OPENSSL/include \
-I$LIBSH/$BERKELEYDB/build_unix \
-I$LIBSH/protobuf-$PROTOBUF/src \
-I$LIBSH/$MINIUPNPC \
-I$LIBSH/$LIBPNG \
-I$LIBSH/libevent-$LIBEVENT-stable/include \
$ADDITIONALCCFLAGS"
export CPPFLAGS

# -I$LIBSH \

LDFLAGS="-L$LIBSH/$OPENSSL \
-L$LIBSH/$BERKELEYDB/build_unix \
-L$LIBSH/$MINIUPNPC/miniupnpc \
-L$LIBSH/$LIBPNG/.libs \
-L$LIBSH/protobuf-$PROTOBUF/src/.libs \
-L$LIBSH/libevent-$LIBEVENT-stable/.libs"
export LDFLAGS

BOOST_ROOT=$LIBSH/$BOOST
export BOOST_ROOT

./configure \
--disable-upnp-default \
--disable-tests \
--with-qt-incdir=$QTPATHMSYS/include \
--with-qt-libdir=$QTPATHMSYS/lib \
--with-qt-plugindir=$QTPATHMSYS/plugins \
--with-qt-bindir=$QTPATHMSYS/bin \
--with-protoc-bindir=$LIBSH/protobuf-$PROTOBUF/src \
--with-gui=qt5
#--with-miniupnpc=no
# --disable-hardening
# --enable-debug

if [ ${?} -ne 0 ]; then echo "client configure failed."; read -n 1 -s; exit 1;fi

#make
mingw32-make
if [ ${?} -ne 0 ]; then echo "client make failed."; read -n 1 -s; exit 1;fi

strip ./src/*.exe
strip ./src/qt/*.exe
